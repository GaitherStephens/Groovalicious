<!--Groovalicious by SPQRGuyMontag with special thanks
    to JunesiPhone and Matchstic-->

<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <title>Groovalicious by SPQRGuyMontag</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <div class='center-dial' id="center-dial">
      <h1 class='center-preview'>HELLO</h1>
      <div class='head'></div>
      <div class='torso'></div>
      <div class='hand-container' id='digital'>
        <div class='digital-hour' id="digital-hour">3</div>
      </div>
      <div class='hand-container' id='digital'>
        <div class='digital-minute' id="digital-minute">58</div>
      </div>
      <div class='hand-container' id='digital'>
        <div class='digital-second' id="digital-second">59</div>
      </div>
      <div class='hand-container' id='hours'>
        <div class='hour-hand' id='hour-hand'></div>
      </div>
      <div class='hand-container' id='seconds'>
        <div class='second-hand' id='second-hand'></div>
      </div>
    </div>
    <div class='day-name-dial'>
      <div class='ring-back'></div>
      <div class='ring' id='r1'>
        <h1 class='day-name-preview'>DAY NAME</h1>
        <h2 class='day-name-text' id='day-name-text'>MON TUE WED THU FRI SAT SUN</h2>
      </div>
    </div>
    <div class='month-dial'>
      <div class='ring-back'></div>
      <div class='ring' id='r2'>
        <h1 class='month-preview'>MONTH</h1>
        <h2 class='month-text' id='month-name-text'>JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV DEC</h2>
      </div>
    </div>
    <div class='day-dial'>
      <div class='ring-back'></div>
      <div class='ring' id='r3'>
        <h1 class='day-preview'>DAY</h1>
        <h2 class='day-text'>01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</h2>
      </div>
    </div>
    <div class='side-ring' id='weather'>
      <div class='icon' id="icon"><img id='wxicon' src="images/wx/27.svg" height="60"></img></div>
      <p class='temperature' id='temperature'>43</p>
    </div>
    <div class='side-ring' id='stats'>
      <div class='bars'>
        <div class='bar'>
          <div class='day-letter' id='battery'>B</div>
          <div class='x' id='x1'></div>
        </div>
        <div class='bar'>
          <div class='day-letter' id='cpu'>C</div>
          <div class='x' id='x2'></div>
        </div>
        <div class='bar'>
          <div class='day-letter' id='ram'>R</div>
          <div class='x' id='x3'></div>
        </div>
        <div class='bar'>
          <div class='day-letter' id='signal'>C</div>
          <div class='x' id='x4'></div>
        </div>
        <div class='bar'>
          <div class='day-letter' id='wifi'>W</div>
          <div class='x' id='x5'></div>
        </div>
        <div class='bar'>
          <div class='day-letter' id='volume'>V</div>
          <div class='x' id='x6'></div>
        </div>
        <div class='bar'>
          <div class='day-letter' id='brightness'>B</div>
          <div class='x' id='x7'></div>
        </div>
      </div>
    </div>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/lettering.js/0.6.1/jquery.lettering.min.js'></script>
    <script src="js/index.js"></script>
    <script type="text/cycript">
      //<![CDATA[
      var widgetIdentifier = "com.gaitherstephens.groovalicious";
      var rgb = rgbOp;
      var widgetOpacity = widgetOpacityOp;
      var textColor = textColorOp;
      var statsUpdateTime = statsUpdateTimeOp;
      var twentyfourhour = twentyfourhourOp;
      var widgetLanguage = widgetLanguageOp;
      var useStats = useStatsOp;
      var useWeather = useWeatherOp;

      //initializes widget
      window.onload = function() {

        //registers widget with IS2
        [IS2Weather registerForWeatherUpdatesWithIdentifier:widgetIdentifier andCallback:^ void () {
          updateWx();
        }];
        updateWx();
        refreshWx();
      }

      // Make sure to de-register ourselves when removed from the user's screen.
      window.onunload = function() {
        [IS2Weather unregisterForUpdatesWithIdentifier:widgetIdentifier];
        [IS2Weather removeRequesterForWeatherTimeInterval:widgetIdentifier];
        return null;
      };

      //calls IS2 weather update on a timer
      function refreshWx(){
        [IS2Weather updateWeather];
        setTimeout(refreshWx, wxRefresh * 60 * 1000);
      }

      // Give column representing passed days and the current day this week a height
      function loadStats() {
          $("#x1").css({
            'height' : ([IS2System batteryPercent] / 2) + 'px',
          });
          $("#x2").css({
            'height' : ([IS2System cpuUsage] / 2) + 'px',
          });
          $("#x3").css({
            'height' : (([IS2System ramFree] / ([IS2System ramFree] + [IS2System ramUsed])) * 50) + 'px',
          });
          $("#x4").css({
            'height' : (([IS2Telephony phoneSignalBars] / 5) * 50) + 'px',
          });
          $("#x5").css({
            'height' : (([IS2Telephony wifiSignalBars] / 3) * 50) + 'px',
          });
          $("#x6").css({
            'height' : ([IS2Media getVolume] * 50) + 'px',
          });
          $("#x7").css({
            'height' : ([IS2System getBrightness] * 50) + 'px',
          });
          setTimeout(loadStats, statsUpdateTime);
      }

      function updateWx(){
        var elem = document.getElementById("wxicon");
        elem.setAttribute("height", "60");
        elem.setAttribute("width", "60");
        elem.setAttribute("src", "images/wx/" + [IS2Weather currentCondition] + ".svg");
        document.getElementById("icon").appendChild(elem);
        document.getElementById("temperature").innerHTML = [IS2Weather currentTemperature] + "&deg";
        document.getElementById("temperature").style.color = tempColor([IS2Weather currentTemperature])
      }
      loadStats();

      function tempColor(c){
        if(c < 0){
          return "#5856D6";
        }else if(c >= 0 && c < 20){
          return "#007AFF";
        }else if(c >= 20 && c < 40){
          return "#5AC8FA";
        }else if(c >= 40 && c < 60){
          return "#4CD964";
        }else if(c >= 60 && c < 80){
          return "#FFCC00";
        }else if(c >= 80 && c < 100){
          return "#FF9500";
        }else if(c > 100){
          return "#FF3B30";
        }
      }

      document.getElementById("r1").style.borderColor = "rgba("+rgb+", "+rgb+", "+rgb+", " + widgetOpacity + ")";
      document.getElementById("r1").style.borderBottomColor = "transparent";
      document.getElementById("r2").style.borderColor = "rgba("+rgb+", "+rgb+", "+rgb+", " + widgetOpacity + ")";
      document.getElementById("r2").style.borderBottomColor = "transparent";
      document.getElementById("r3").style.borderColor = "rgba("+rgb+", "+rgb+", "+rgb+", " + widgetOpacity + ")";
      document.getElementById("r3").style.borderBottomColor = "transparent";
      document.getElementById("center-dial").style.backgroundColor = "rgba("+rgb+", "+rgb+", "+rgb+", " + widgetOpacity + ")";
      document.getElementById("weather").style.backgroundColor = "rgba("+rgb+", "+rgb+", "+rgb+", " + widgetOpacity + ")";
      document.getElementById("stats").style.backgroundColor = "rgba("+rgb+", "+rgb+", "+rgb+", " + widgetOpacity + ")";

      var h2Elements = document.getElementsByTagName("h2");
      for(var i = 0; i < h2Elements.length; i++){
        h2Elements[i].style.color = textColor;
      }

      document.getElementById("stats").style.color = textColor;

      if(rgb === "0"){
        document.getElementById("digital-hour").style.color = "white";
  			document.getElementById("digital-minute").style.color = "white";
        document.getElementById("digital-second").style.color = "red";
      }else if(rgb === "255"){
        document.getElementById("digital-hour").style.color = "black";
  			document.getElementById("digital-minute").style.color = "black";
        document.getElementById("digital-second").style.color = "red";
      }

      if(widgetLanguage === "nl"){
        document.getElementById("day-name-text").innerHTML = "ZON MAA DIN WOE DON VRI ZAT";
        document.getElementById("month-name-text").innerHTML = "JAN FEB MAR APR MEI JUN JUL AUG SEP OCT NOV DEC";
      }else if(widgetLanguage === "ru"){
        document.getElementById("day-name-text").innerHTML = "Вос Пон Вто Сре Чет Пят Суб";
        document.getElementById("month-name-text").innerHTML = "Янв Фев Мар Апр Май Июн Июл Авг Сен Окт Ноя Дек";
      }else if(widgetLanguage === "it"){
        document.getElementById("day-name-text").innerHTML = "SUN MON MAR MER GIO VEN SAT";
        document.getElementById("month-name-text").innerHTML = "GEN FEB MAR APR MAG GIU LUG AGO SET OTT NOV DIC";
      }else if(widgetLanguage === "sp"){
        document.getElementById("day-name-text").innerHTML = "SOL MON MAR MIE JUE VIE SAT";
        document.getElementById("month-name-text").innerHTML = "ENE FEB MAR ABR MAY JUN JUL AUG SEP OCT NOV DIC";
      }else if(widgetLanguage === "de"){
        document.getElementById("day-name-text").innerHTML = "SON MON DIE MIT DON FRE SAM";
        document.getElementById("month-name-text").innerHTML = "JAN FEB MAR APR MAI JUN JUL AUG SEP OKT NOV DEZ";
      }else if(widgetLanguage === "fr"){
        document.getElementById("day-name-text").innerHTML = "DIM LUN MAR MER JEU VEN SAM";
        document.getElementById("month-name-text").innerHTML = "JAN FEV MAR AVR MAI JUI JUI AOU SEP OCT NOV DEC";
      }else if(widgetLanguage === "pl"){
        document.getElementById("day-name-text").innerHTML = "NIE PON WTO SRO CZW PIA SOB";
        document.getElementById("month-name-text").innerHTML = "STY LUT MAR KWI MAJ CZE LIP SIE WRZ PAZ LIS GRU";
      }else if(widgetLanguage === "pt"){
        document.getElementById("day-name-text").innerHTML = "DOM SEG TER QUA QUI SEX SAB";
        document.getElementById("month-name-text").innerHTML = "JAN FEV MAR ABR MAI JUN JUL AGO SET OUT NOV DEZ";
      }

      //hides stats ring
      if(!useStats){
        document.getElementById("stats").style.opacity = 0;
      }

      //hides weather ring
      if(!useWeather){
        document.getElementById("weather").style.opacity = 0;
      }

      //]]>
    </script>
  </body>
</html>
